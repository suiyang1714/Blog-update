## 引子 ## 
> 攒了快两个月的 *Bug* ，攒着攒着我可能都快忘干净了。也不管以前的 *bug* 了，先把眼前的 *bug* 解决下。主要是页面请求数据所用的时间超长，竟然达到了6-10s 之后才渲染出数据。总大小才500k...第二个又是评论系统有问题。第三个是整个网站的字体大小有点问题。   
> 现在想到就是这三个，一个个来。

## 1.数据处理问题 ##

在之前的 *ajax* 请求数据的时候，请求过来的数据都是直接从数据库提取出来的，没经过任何处理，返回所有的相关数据，前台用哪个取哪个，一些数据的处理也是由前台来处理的。   后台也没专门多做几个接口，返回指定的字段，完全是由后台返回一大包，前台自己分门别类。前期数据量少没什么，但是数据量一多了，这样只请求一次，后台返回过来就有点慢，所以就分为多个ajax请求，多做几个接口处理这些问题。

## 2. 文章内容导航以及一键返回顶部

### 文章内容导航 ###
在阅读之前的笔记中发现，有一些知识点想要温习的时候一时半会还找不到，所以急需一个内容的节点导航。   

当时的想法是今晚一定做一个...

说来惭愧，拖了这么久，才实现这个功能。
这个的做法也比较简单，根据 *markdown* 内的标题作为锚点来跳转，我做的处理是 *h2* 标题作为一级， *h3* 标题作为二级，两个层级可以了。

其中遇到的问题也比较尴尬，我的当时的想法是，当挂在结束的时候，运行那段生成导航的 *JS*，理论上这时候标签和 *data* 都应该初始化完成了，但实际上，初始化完成的时候，ajax还没有返回数据，相当于这段代码没效果。   
走了不少弯路才发现是这里出了问题，所以在请求过数据之后运行，破费。

### 一键返回顶部 ###
这个也没啥好说的了，*copy* 了以前写的代码。

## 3.回复功能(又是回复功能) ##
### 回复头像问题 ###
由于默认头像都是西服男，无法跟游客区分开，某些搞怪分子借机瞎评论，把我的评论玩坏了。
对这个处理就是给我的账号单独加了个字段，区别开来。
### 同名用户处理问题 ###
之前对填写注册的处理是只要不同名就可以，忽略同名了，但是邮箱和网址不同，返回的数据还是之前第一个注册用户信息，所以对这个地方进行了两重判断，网址就不做硬性规定了。

### 评论系统崩溃？ ###
之前同事在大量评论测试表情的时候，换了两个账户，其中有一条评论没有存上文章的 *_id* ，导致提取数据的时候，报错了。之后又做了几次测试，发现没有出现问题，也不知道他当时是什么操作，对这个问题我只能先优化了一下代码，没做处理，看以后的表现了。



> 昨天和今天忙里偷闲改了一点 *bug* ，也都是小问题，耗费时间也挺长的，再一次证明了自己的菜。其实我第一时间研究的问题是 *ajax* 请求时间长达10s的问题，无奈看了好久都没太懂到底哪里出了问题，准备明天集中精力研究那个问题。